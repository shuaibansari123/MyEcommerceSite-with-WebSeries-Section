{% extends 'shop/basic.html' %}
{% block title%} Checkout - ShopEase{% endblock %}

{% block ul %}
<li class="nav-item ml-2 mr-2">
    <a class="nav-link" href="/shop" style="color: white !important; margin:auto; font-family:var(--font-1);font-weight:600; border-radius:20px; padding:8px 16px; text-decoration: none; transition: all 0.3s;">Home</a>
</li>

<li class="nav-item ml-2 mr-2">
    <a class="nav-link" href="/shop/about" style="color: white !important; margin:auto; font-family:var(--font-1);font-weight:600; border-radius:20px; padding:8px 16px; text-decoration: none; transition: all 0.3s;">About</a>
</li>

<li class="nav-item ml-2 mr-2">
    <a class="nav-link" href="/shop/tracker" style="color: white !important; margin:auto; font-family:var(--font-1);font-weight:600; border-radius:20px; padding:8px 16px; text-decoration: none; transition: all 0.3s;">Tracker</a>
</li>

<li class="nav-item ml-2 mr-2">
    <a class="nav-link" href="/blog" style="color: white !important; margin:auto; font-family:var(--font-1);font-weight:600; border-radius:20px; padding:8px 16px; text-decoration: none; transition: all 0.3s;">Blog</a>
</li>

<li class="nav-item active ml-2 mr-2">
    <a class="nav-link" href="/shop/contact" style="margin:auto; font-family:var(--font-1);font-weight:600; border-radius:25px; padding:8px 16px; background: var(--gradient-primary); color:white; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); text-decoration: none;">Checkout</a>
</li>

{% endblock %}




{% block body %}
<div class="container py-5" style="background: linear-gradient(135deg, #f8fafc, #e2e8f0); min-height: 100vh;">
    <!-- Checkout Header -->
    <div class="row justify-content-center mb-5">
        <div class="col-lg-8 text-center">
            <h1 class="display-4 fw-bold mb-3" style="font-family: 'Inter', sans-serif; color: var(--primary); text-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                ðŸ›’ Secure Checkout
            </h1>
            <p class="lead text-muted" style="font-family: 'Inter', sans-serif;">
                Complete your order in just a few simple steps
            </p>
            <!-- Progress Indicator -->
            <div class="progress mb-4" style="height: 6px; border-radius: 10px;">
                <div class="progress-bar" role="progressbar" style="width: 50%; background: var(--gradient-primary);" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Step 1: Cart Review -->
            <div class="card mb-4" style="border: none; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white;">
                <div class="card-header" style="background: var(--gradient-primary); color: white; border-radius: 20px 20px 0 0; padding: 20px;">
                    <h3 class="mb-0" style="font-family: 'Inter', sans-serif; font-weight: 700;">
                        <span class="badge bg-light text-primary me-3" style="font-size: 1rem;">1</span>
                        Review Your Cart Items
                    </h3>
                </div>
                <div class="card-body p-4">
                    <div id="items-container">
                        <ul class="list-group list-group-flush" id="items">
                            <!-- Cart items will be populated here -->
                        </ul>
                    </div>
                    <div id="cart-summary" class="mt-4 p-3" style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 15px; border-left: 4px solid var(--primary);">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0" style="color: var(--primary); font-weight: 600;">Total Amount:</h5>
                            <h4 class="mb-0" id="total-amount" style="color: var(--primary); font-weight: 700;">â‚¹0</h4>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Address & Details -->
            <div class="card mb-4" style="border: none; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white;">
                <div class="card-header" style="background: var(--gradient-primary); color: white; border-radius: 20px 20px 0 0; padding: 20px;">
                    <h3 class="mb-0" style="font-family: 'Inter', sans-serif; font-weight: 700;">
                        <span class="badge bg-light text-primary me-3" style="font-size: 1rem;">2</span>
                        Shipping & Contact Information
                    </h3>
                </div>
                <div class="card-body p-4">
                    <form method="post" action="/shop/checkout/">{% csrf_token %}
                        <input type="hidden" name="itemsJson" id="itemsJson">
                        
                        <!-- Personal Information -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="name" class="form-label" style="font-weight: 600; font-family: 'Inter', sans-serif; color: var(--dark);">
                                    <i class="fas fa-user me-2" style="color: var(--primary);"></i>Full Name
                                </label>
                                <input type="text" class="form-control" id="name" name="name" placeholder="Enter your full name" 
                                       style="border-radius: 12px; border: 2px solid #e2e8f0; padding: 12px 16px; font-family: 'Inter', sans-serif; transition: all 0.3s; background: #f8fafc;">
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label" style="font-weight: 600; font-family: 'Inter', sans-serif; color: var(--dark);">
                                    <i class="fas fa-envelope me-2" style="color: var(--primary);"></i>Email Address
                                </label>
                                <input type="email" class="form-control" id="email" name="email" placeholder="your@email.com"
                                       style="border-radius: 12px; border: 2px solid #e2e8f0; padding: 12px 16px; font-family: 'Inter', sans-serif; transition: all 0.3s; background: #f8fafc;">
                            </div>
                        </div>

                        <!-- Address Information -->
                        <h5 class="mb-3" style="color: var(--primary); font-weight: 600; font-family: 'Inter', sans-serif;">
                            <i class="fas fa-map-marker-alt me-2"></i>Shipping Address
                        </h5>
                        
                        <div class="mb-3">
                            <label for="address1" class="form-label" style="font-weight: 600; font-family: 'Inter', sans-serif; color: var(--dark);">Street Address</label>
                            <input type="text" class="form-control" id="address1" name="address1" placeholder="1234 Main Street"
                                   style="border-radius: 12px; border: 2px solid #e2e8f0; padding: 12px 16px; font-family: 'Inter', sans-serif; transition: all 0.3s; background: #f8fafc;">
                        </div>
                        
                        <div class="mb-3">
                            <label for="address2" class="form-label" style="font-weight: 600; font-family: 'Inter', sans-serif; color: var(--dark);">Apartment, Suite, etc. (Optional)</label>
                            <input type="text" class="form-control" id="address2" name="address2" placeholder="Apartment, studio, or floor"
                                   style="border-radius: 12px; border: 2px solid #e2e8f0; padding: 12px 16px; font-family: 'Inter', sans-serif; transition: all 0.3s; background: #f8fafc;">
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="city" class="form-label" style="font-weight: 600; font-family: 'Inter', sans-serif; color: var(--dark);">City</label>
                                <input type="text" class="form-control" id="city" name="city" placeholder="Delhi, Mumbai, etc."
                                       style="border-radius: 12px; border: 2px solid #e2e8f0; padding: 12px 16px; font-family: 'Inter', sans-serif; transition: all 0.3s; background: #f8fafc;">
                            </div>
                            <div class="col-md-4">
                                <label for="state" class="form-label" style="font-weight: 600; font-family: 'Inter', sans-serif; color: var(--dark);">State</label>
                                <input type="text" class="form-control" id="state" name="state" placeholder="Enter State"
                                       style="border-radius: 12px; border: 2px solid #e2e8f0; padding: 12px 16px; font-family: 'Inter', sans-serif; transition: all 0.3s; background: #f8fafc;">
                            </div>
                            <div class="col-md-2">
                                <label for="zip_code" class="form-label" style="font-weight: 600; font-family: 'Inter', sans-serif; color: var(--dark);">ZIP Code</label>
                                <input type="text" class="form-control" id="zip_code" name="zip_code" placeholder="110059"
                                       style="border-radius: 12px; border: 2px solid #e2e8f0; padding: 12px 16px; font-family: 'Inter', sans-serif; transition: all 0.3s; background: #f8fafc;">
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="phone" class="form-label" style="font-weight: 600; font-family: 'Inter', sans-serif; color: var(--dark);">
                                <i class="fas fa-phone me-2" style="color: var(--primary);"></i>Phone Number
                            </label>
                            <input type="tel" class="form-control" id="phone" name="phone" placeholder="+91 98765 43210"
                                   style="border-radius: 12px; border: 2px solid #e2e8f0; padding: 12px 16px; font-family: 'Inter', sans-serif; transition: all 0.3s; background: #f8fafc;">
                        </div>

                        <!-- Place Order Button -->
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-lg" 
                                    style="background: var(--gradient-primary); border: none; color: white; font-family: 'Inter', sans-serif; font-weight: 700; border-radius: 15px; padding: 15px 30px; box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3); transition: all 0.3s; position: relative; overflow: hidden;">
                                <span style="position: relative; z-index: 2;">
                                    <i class="fas fa-credit-card me-2"></i>
                                    Place Order Securely
                                </span>
                            </button>
                        </div>
                        
                        <!-- Security Badge -->
                        <div class="text-center mt-3">
                            <small class="text-muted" style="font-family: 'Inter', sans-serif;">
                                <i class="fas fa-shield-alt me-1" style="color: var(--success);"></i>
                                Your information is secure and encrypted
                            </small>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block js %}
<script>
if (localStorage.getItem('cart') == null) {
    var cart = {};
} else {
    cart = JSON.parse(localStorage.getItem('cart'));
}
console.log(cart);
var sum = 0;
var totalAmount = 0;

if ($.isEmptyObject(cart)) {
    // If cart is empty
    mystr = `<div class="text-center py-4">
                <div class="empty-cart-icon mb-3" style="font-size: 3rem; color: #cbd5e1;">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <h5 style="color: var(--dark); font-family: 'Inter', sans-serif; font-weight: 600;">Your cart is empty</h5>
                <p style="color: #6b7280; font-family: 'Inter', sans-serif;">Add some items to your cart before checking out</p>
                <a href="/shop" class="btn btn-primary mt-3" style="background: var(--gradient-primary); border: none; border-radius: 25px; padding: 12px 30px; font-family: 'Inter', sans-serif; font-weight: 600;">
                    <i class="fas fa-shopping-bag me-2"></i>Continue Shopping
                </a>
            </div>`
    $('#items').append(mystr);
    $('#total-amount').text('â‚¹0');
} else {
    for (item in cart) {
        let name = cart[item][1];
        let qty = cart[item][0];
        let price = cart[item][2] || 0; // Use stored price or 0 as fallback
        
        // If price is not stored in cart (old cart format), try to get from DOM
        if (!price && document.getElementById('pricepr' + item.slice(2))) {
            price = parseInt(document.getElementById('pricepr' + item.slice(2)).innerHTML.replace('â‚¹', ''));
        }
        
        sum = sum + qty;
        let itemTotal = qty * price;
        totalAmount = totalAmount + itemTotal;
        
        mystr = `<li class="list-group-item border-0 px-0 py-3" style="background: transparent;">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div class="item-info">
                                <h6 class="mb-1" style="color: var(--dark); font-family: 'Inter', sans-serif; font-weight: 600;">${name}</h6>
                                <small class="text-muted" style="font-family: 'Inter', sans-serif;">â‚¹${price} each</small>
                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <span class="badge bg-primary me-3" style="font-size: 0.9rem; padding: 8px 12px; border-radius: 20px;">
                                Qty: ${qty}
                            </span>
                            <strong style="color: var(--primary); font-family: 'Inter', sans-serif; font-weight: 700; font-size: 1.1rem;">
                                â‚¹${itemTotal}
                            </strong>
                        </div>
                    </div>
                </li>`
        $('#items').append(mystr);
    }
    
    // Update total amount display
    $('#total-amount').text('â‚¹' + totalAmount);
}

// Update cart count if element exists
if (document.getElementById('cart')) {
    document.getElementById('cart').innerHTML = sum;
}

$('#itemsJson').val(JSON.stringify(cart));
{% if thank %}
alert('Thanks for ordering with us. Your order is is {{id}}. Use it to track your order using our order tracker');
localStorage.clear();
document.location = "/shop";


{% endif %}
</script>
{% endblock %}
