{% extends 'shop/basic.html' %}
{% load static %}
{% block title%} Order Tracker - ShopEase{% endblock %}

{% block ul %}
<li class="nav-item ml-2 mr-2">
    <a class="nav-link" href="/shop" style="color: white !important; margin:auto; font-family:var(--font-1);font-weight:600; border-radius:20px; padding:8px 16px; text-decoration: none; transition: all 0.3s;">Home</a>
</li>

<li class="nav-item ml-2 mr-2">
    <a class="nav-link" href="/shop/about" style="color: white !important; margin:auto; font-family:var(--font-1);font-weight:600; border-radius:20px; padding:8px 16px; text-decoration: none; transition: all 0.3s;">About</a>
</li>

<li class="nav-item active ml-2 mr-2">
    <a class="nav-link" href="/shop/tracker" style="margin:auto; font-family:var(--font-1);font-weight:600; border-radius:25px; padding:8px 16px; background: var(--gradient-primary); color:white; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); text-decoration: none;">Tracker</a>
</li>

<li class="nav-item ml-2 mr-2">
    <a class="nav-link" href="/blog" style="color: white !important; margin:auto; font-family:var(--font-1);font-weight:600; border-radius:20px; padding:8px 16px; text-decoration: none; transition: all 0.3s;">Blog</a>
</li>

<li class="nav-item ml-2 mr-2">
    <a class="nav-link" href="/shop/contact" style="color: white !important; margin:auto; font-family:var(--font-1);font-weight:600; border-radius:20px; padding:8px 16px; text-decoration: none; transition: all 0.3s;">Contact</a>
</li>
{% endblock %}

{% block body %}
<!-- Tracker Hero Section -->
<section class="tracker-hero" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.9), rgba(5, 150, 105, 0.8)), url('{% static 'shop/images/hero.png' %}'); background-size: cover; background-position: center; min-height: 60vh; display: flex; align-items: center; position: relative;">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-lg-8">
                <div class="hero-content" style="animation: fadeInUp 1s ease-out;">
                    <h1 class="display-3 fw-bold text-white mb-4" style="font-family: 'Inter', sans-serif; text-shadow: 2px 2px 8px rgba(0,0,0,0.4);">
                        <i class="fas fa-shipping-fast me-3" style="color: #fbbf24;"></i>
                        Order Tracker
                    </h1>
                    <p class="lead text-white mb-4" style="font-family: 'Inter', sans-serif; opacity: 0.95; font-size: 1.3rem;">
                        Track your orders in real-time and stay updated with delivery status
                    </p>
                    <div class="hero-stats d-flex justify-content-center gap-4 flex-wrap">
                        <div class="stat-item text-center">
                            <div class="stat-number text-white" style="font-size: 2rem; font-weight: 700;">24/7</div>
                            <div class="stat-label text-white" style="opacity: 0.8;">Tracking</div>
                        </div>
                        <div class="stat-item text-center">
                            <div class="stat-number text-white" style="font-size: 2rem; font-weight: 700;">Real-time</div>
                            <div class="stat-label text-white" style="opacity: 0.8;">Updates</div>
                        </div>
                        <div class="stat-item text-center">
                            <div class="stat-number text-white" style="font-size: 2rem; font-weight: 700;">Secure</div>
                            <div class="stat-label text-white" style="opacity: 0.8;">Tracking</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<div class="container py-5" style="background: linear-gradient(135deg, #f1f5f9, #e2e8f0); min-height: 100vh; font-family: 'Inter', sans-serif;">
    
    <!-- Tracking Form Section -->
    <div class="row justify-content-center mb-5">
        <div class="col-lg-8">
            <div class="card" style="border: none; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.08); background: white; border-left: 4px solid #10b981;">
                <div class="card-header" style="background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 20px 20px 0 0; padding: 25px;">
                    <h3 class="mb-0" style=" color:white !important; font-family: 'Inter', sans-serif; font-weight: 700; font-size: 1.4rem;">
                        <span class="badge me-3" style="background: rgba(255,255,255,0.2); color: white; font-size: 1rem; padding: 8px 12px; border-radius: 12px;">ðŸ“¦</span>
                        Track Your Order
                    </h3>
                    <p class="mb-0 mt-2" style="color:white !important;  opacity: 0.9; font-size: 0.95rem;">Enter your order details to get real-time tracking information</p>
                </div>
                <div class="card-body p-4">
                    <form method="post" action="#" id="trackerForm">{% csrf_token %}
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label for="orderId" class="form-label" style="font-weight: 700; font-family: 'Inter', sans-serif; color: #1e293b; font-size: 0.95rem;">
                                    <i class="fas fa-hashtag me-2" style="color: #10b981;"></i>Order ID
                                </label>
                                <input type="text" class="form-control" id="orderId" name="orderId" placeholder="Enter your order ID" 
                                       style="border-radius: 12px; border: 2px solid #cbd5e1; padding: 14px 18px; font-family: 'Inter', sans-serif; transition: all 0.3s; background: #ffffff; color: #1e293b; font-weight: 500;" 
                                       onfocus="this.style.border='2px solid #10b981'; this.style.boxShadow='0 0 0 3px rgba(16, 185, 129, 0.1)';" 
                                       onblur="this.style.border='2px solid #cbd5e1'; this.style.boxShadow='none';">
                            </div>
                            <div class="col-md-6 mb-4">
                                <label for="email" class="form-label" style="font-weight: 700; font-family: 'Inter', sans-serif; color: #1e293b; font-size: 0.95rem;">
                                    <i class="fas fa-envelope me-2" style="color: #10b981;"></i>Email Address
                                </label>
                                <input type="email" class="form-control" id="email" name="email" placeholder="your@email.com"
                                       style="border-radius: 12px; border: 2px solid #cbd5e1; padding: 14px 18px; font-family: 'Inter', sans-serif; transition: all 0.3s; background: #ffffff; color: #1e293b; font-weight: 500;"
                                       onfocus="this.style.border='2px solid #10b981'; this.style.boxShadow='0 0 0 3px rgba(16, 185, 129, 0.1)';" 
                                       onblur="this.style.border='2px solid #cbd5e1'; this.style.boxShadow='none';">
                            </div>
                        </div>
                        <div class="text-center">
                            <button type="submit" class="btn btn-lg px-5 py-3" style="background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 25px; font-family: 'Inter', sans-serif; font-weight: 700; box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3); transition: all 0.3s; position: relative; overflow: hidden;"
                                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 12px 35px rgba(16, 185, 129, 0.4)';"
                                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(16, 185, 129, 0.3)';">
                                <i class="fas fa-search me-2"></i>Track Order
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Details Section -->
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card" style="border: none; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.08); background: white; border-left: 4px solid #3b82f6; min-height: 300px;">
                <div class="card-header" style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border-radius: 20px 20px 0 0; padding: 20px;">
                    <h4 class="mb-0" style=" color:white !important;  font-family: 'Inter', sans-serif; font-weight: 700;">
                        <i class="fas fa-box me-2"></i>Order Details
                    </h4>
                </div>
                <div class="card-body p-4">
                    <div id="order-details-container">
                        <ul class="list-group list-group-flush" id="citems">
                            <div class="text-center py-5" style="color: #64748b;">
                                <i class="fas fa-box-open" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                                <p style="font-family: 'Inter', sans-serif; font-weight: 500;">Enter your order ID and email to view order details</p>
                            </div>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card" style="border: none; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.08); background: white; border-left: 4px solid #f59e0b; min-height: 300px;">
                <div class="card-header" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border-radius: 20px 20px 0 0; padding: 20px;">
                    <h4 class="mb-0" style="color:white !important;  font-family: 'Inter', sans-serif; font-weight: 700;">
                        <i class="fas fa-truck me-2"></i>Order Status
                    </h4>
                </div>
                <div class="card-body p-4">
                    <div id="order-status-container">
                        <ul class="list-group list-group-flush" id="items">
                            <div class="text-center py-5" style="color: #64748b;">
                                <i class="fas fa-route" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                                <p style="font-family: 'Inter', sans-serif; font-weight: 500;">Enter your order ID and email to track your order status</p>
                            </div>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Section -->
    <div class="row justify-content-center mt-5">
        <div class="col-lg-8">
            <div class="text-center p-4" style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 20px; border: 1px solid rgba(59, 130, 246, 0.2);">
                <h5 style="color: #1e40af; font-family: 'Inter', sans-serif; font-weight: 700; margin-bottom: 1rem;">
                    <i class="fas fa-question-circle me-2"></i>Need Help?
                </h5>
                <p style="color: #64748b; font-family: 'Inter', sans-serif; margin-bottom: 1.5rem;">
                    Can't find your order? Contact our support team for assistance.
                </p>
                <div class="d-flex justify-content-center gap-3 flex-wrap">
                    <a href="/shop/contact" class="btn" style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 20px; padding: 10px 20px; font-family: 'Inter', sans-serif; font-weight: 600; text-decoration: none;">
                        <i class="fas fa-headset me-2"></i>Contact Support
                    </a>
                    <a href="/shop" class="btn" style="background: transparent; color: #3b82f6; border: 2px solid #3b82f6; border-radius: 20px; padding: 10px 20px; font-family: 'Inter', sans-serif; font-weight: 600; text-decoration: none;">
                        <i class="fas fa-home me-2"></i>Back to Shop
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
<script>
$('#trackerForm').submit(function(event) {
    // Clear previous results
    $('#items').empty();
    $('#citems').empty();
    
    // Show loading states
    $('#items').html(`
        <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2" style="color: #64748b; font-family: 'Inter', sans-serif;">Tracking your order...</p>
        </div>
    `);
    
    $('#citems').html(`
        <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2" style="color: #64748b; font-family: 'Inter', sans-serif;">Loading order details...</p>
        </div>
    `);
    
    var formData = {
        'orderId': $('input[name=orderId]').val(),
        'email': $('input[name=email]').val(),
        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
    };
    
    $.ajax({
        type: 'POST',
        url: '/shop/tracker',
        data: formData,
        encode: true
    })
    .done(function(data) {
        console.log(data);
        data = JSON.parse(data);
        updates = data[0];
        
        // Clear loading states
        $('#items').empty();
        $('#citems').empty();
        
        console.log(data);
        console.log(updates.length);
        
        if (updates.length > 0 && updates != {}) {
            for (i = 0; i < updates.length; i++) {
                let text = updates[i]['text'];
                let time = updates[i]['time'];
                let statusIcon = i === 0 ? 'fas fa-check-circle' : 'fas fa-clock';
                let statusColor = i === 0 ? '#10b981' : '#f59e0b';
                
                mystr = `<li class="list-group-item border-0 px-0 py-3" style="background: linear-gradient(135deg, #f8fafc, #ffffff); border-radius: 12px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 4px solid ${statusColor};">
                    <div class="d-flex align-items-start">
                        <div class="status-icon me-3" style="width: 40px; height: 40px; background: ${statusColor}; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="${statusIcon}" style="color: white; font-size: 1rem;"></i>
                        </div>
                        <div class="flex-grow-1">
                            <p class="mb-1" style="color: #1e293b; font-family: 'Inter', sans-serif; font-weight: 600; font-size: 0.95rem;">${text}</p>
                            <small style="color: #64748b; font-family: 'Inter', sans-serif;">
                                <i class="fas fa-calendar-alt me-1"></i>${time}
                            </small>
                        </div>
                    </div>
                </li>`;
                $('#items').append(mystr);
            }
        } else {
            mystr = `<div class="text-center py-4">
                <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ef4444; margin-bottom: 1rem;"></i>
                <h6 style="color: #ef4444; font-family: 'Inter', sans-serif; font-weight: 600; margin-bottom: 0.5rem;">Order Not Found</h6>
                <p style="color: #64748b; font-family: 'Inter', sans-serif; font-size: 0.9rem;">
                    Sorry, we couldn't find an order with this ID and email combination. Please check your details and try again.
                </p>
            </div>`;
            $('#items').append(mystr);
        }

        // Fill the order details
        cart = JSON.parse(data[1]);
        if (Object.keys(cart).length > 0) {
            for (item in cart) {
                let name = cart[item][1];
                let qty = cart[item][0];
                
                mystr = `<li class="list-group-item border-0 px-0 py-3" style="background: linear-gradient(135deg, #f8fafc, #ffffff); border-radius: 12px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 4px solid #3b82f6;">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div class="product-icon me-3" style="width: 40px; height: 40px; background: linear-gradient(135deg, #3b82f6, #2563eb); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-box" style="color: white; font-size: 1rem;"></i>
                            </div>
                            <div>
                                <h6 class="mb-0" style="color: #1e293b; font-family: 'Inter', sans-serif; font-weight: 600; font-size: 0.95rem;">${name}</h6>
                                <small style="color: #64748b; font-family: 'Inter', sans-serif;">Product Item</small>
                            </div>
                        </div>
                        <span class="badge" style="background: rgba(59, 130, 246, 0.1); color: #3b82f6; font-size: 0.8rem; padding: 6px 12px; border-radius: 20px; font-weight: 600;">
                            Qty: ${qty}
                        </span>
                    </div>
                </li>`;
                $("#citems").append(mystr);
            }
        } else {
            $('#citems').html(`
                <div class="text-center py-4" style="color: #64748b;">
                    <i class="fas fa-box-open" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                    <p style="font-family: 'Inter', sans-serif; font-weight: 500;">No order details found</p>
                </div>
            `);
        }
    })
    .fail(function() {
        $('#items').html(`
            <div class="text-center py-4">
                <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ef4444; margin-bottom: 1rem;"></i>
                <h6 style="color: #ef4444; font-family: 'Inter', sans-serif; font-weight: 600;">Error</h6>
                <p style="color: #64748b; font-family: 'Inter', sans-serif;">Failed to track order. Please try again.</p>
            </div>
        `);
        $('#citems').html(`
            <div class="text-center py-4" style="color: #64748b;">
                <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ef4444; margin-bottom: 1rem;"></i>
                <p style="font-family: 'Inter', sans-serif; font-weight: 500;">Failed to load order details</p>
            </div>
        `);
    });
    
    event.preventDefault();
});
</script>
{% endblock %}
